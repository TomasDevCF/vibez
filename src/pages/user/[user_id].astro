---
import { db } from "astro:db";
import Layout from "../../layouts/Layout.astro";
import { Users } from "astro:db";
import { eq } from "astro:db";
import { HomePage } from "../../layouts/HomePage";
import UserHeader from "../../components/UserHeader.astro";
import UserPosts from "../../components/UserPosts";

const { user_id } = Astro.params;
const accountId = Astro.cookies.get("accountId");

if (!accountId) {
  return Astro.redirect("/register");
}

const userInfo = await db
  .select()
  .from(Users)
  .where(eq(Users.user_id, parseInt(user_id as string)));

if (userInfo.length === 0) {
  return Astro.redirect("/");
}
---

<Layout
  title={userInfo.length == 0
    ? "Desconocido."
    : `Perfil de ${userInfo[0].name}`}
>
  {
    userInfo.length != 0 && (
      <HomePage
        style={{ overflowY: "auto", scrollbarWidth: "none" }}
        client:load
      >
        <UserHeader userInfo={userInfo[0]} />
        <UserPosts client:load userId={userInfo[0].user_id} />
      </HomePage>
    )
  }
</Layout>

<style is:global>
  body {
    background-color: rgb(26, 26, 26) !important;
    display: grid !important;
    grid-template-areas: "aside-l main aside-r";
    grid-template-columns: 250px 1fr 250px;
    max-width: 1024px;
    place-items: center;
  }
</style>
